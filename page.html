<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Raspbeat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .api-button {
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            background-color: #ddd;
            border: none;
            border-radius: 5px;
        }

        .loop-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .loop {
            background: #e9e9e9;
            padding: 10px;
            margin: 10px;
            width: calc(50% - 20px);
            text-align: center;
            cursor: pointer;
        }

        .loop.playing {
            background: #d1eaff;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Raspbeat</h1>
    </div>
    <div class="button-container">
        <button class="api-button" id="startEffect" onclick="startEffect()">START</button>
        <label for="effets">Choisi un effet</label>
        <select id="effets" name="effets">
        </select>
        <button class="api-button" id="stopEffect" onclick="stopEffect()">STOP</button>
        <button class="api-button" id="startLoop" onclick="toggleRecord()">Toggle Record</button>
    </div>
    <div class="loop-container" id="loopContainer"></div>
</div>

<script>

    async function loadEffects(){
        var effects = []
    await fetch('http://127.0.0.1:8000/effects',{
        method: 'GET',
        headers: {
             'Content-Type': 'application/json',
        },
    }).then(response => response.json())
        .then(data => effects = data )
        .catch((error) => console.error('Error:', error));
        const sel = document.getElementById("effets")
        effects.forEach(effect => {
            const opt = document.createElement("option");
            opt.value = effect
            opt.text = effect;
            sel.add(opt);
        })
    }


    function getSelectedValue() {
            // Get the select element
            var selectElement = document.getElementById("effets");

            // Get the selected option
            var selectedOption = selectElement.options[selectElement.selectedIndex];

            // Get the value of the selected option
            return selectedOption.value
        }


    loadEffects();
        function startEffect() {

            const effect = getSelectedValue()
            fetch(`http://127.0.0.1:8000/start/${effect}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => console.log(data))
                .catch((error) => console.error('Error:', error));
        }


        function stopEffect() {
            fetch('http://127.0.0.1:8000/stop', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => console.log(data))
                .catch((error) => console.error('Error:', error));
        }

        function toggleRecord() {

            fetch(`http://127.0.0.1:8000/record`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => response.json())
                .then(data => console.log(data))
                .catch((error) => console.error('Error:', error));
        }
</script>
</body>
</html>